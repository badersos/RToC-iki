<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#8B5CF6">
    <title>All Pages | Regressor's Tale of Cultivation Wiki</title>
    <link rel="icon" type="image/jpeg" href="../assets/images/seo_eun_hyun_cover.jpg">
    <link rel="stylesheet" href="../styles/main.css">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700;900&family=Inter:wght@400;500;600;700&family=Outfit:wght@500;600;700;800&display=swap"
        rel="stylesheet">
    <!-- Ionicons for Icons -->
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <script src="../scripts/api-config.js"></script>
    <style>
        .pages-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .pages-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .pages-header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            color: #fff;
        }
        
        .pages-header p {
            color: #aaa;
            font-size: 1.1rem;
        }
        
        .pages-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }
        
        .page-preview-card {
            background: linear-gradient(135deg, #1a1a24 0%, #12121a 100%);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            text-decoration: none;
            display: block;
            height: 100%;
        }
        
        .page-preview-card:hover {
            transform: translateY(-4px);
            border-color: rgba(139, 92, 246, 0.5);
            box-shadow: 0 8px 24px rgba(139, 92, 246, 0.3);
        }
        
        .page-preview-thumbnail {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, #2a2a3a 0%, #1a1a24 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .page-preview-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .page-preview-thumbnail .page-icon {
            font-size: 4rem;
            color: rgba(139, 92, 246, 0.3);
        }
        
        .page-preview-content {
            padding: 1.5rem;
        }
        
        .page-preview-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #fff;
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }
        
        .page-preview-path {
            font-size: 0.85rem;
            color: #888;
            font-family: monospace;
            word-break: break-all;
        }
        
        .page-preview-category {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: rgba(139, 92, 246, 0.2);
            color: #A78BFA;
            border-radius: 6px;
            font-size: 0.75rem;
            margin-top: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .loading-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #888;
        }
        
        .loading-state ion-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #8B5CF6;
        }
        
        .search-filter {
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .search-filter input {
            flex: 1;
            padding: 0.75rem 1rem;
            background: rgba(0,0,0,0.4);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            color: #fff;
            font-size: 0.95rem;
        }
        
        .search-filter input:focus {
            outline: none;
            border-color: rgba(139, 92, 246, 0.5);
        }
        
        .filter-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 0.5rem 1rem;
            background: rgba(139, 92, 246, 0.2);
            border: 1px solid rgba(139, 92, 246, 0.3);
            color: #A78BFA;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.85rem;
        }
        
        .filter-btn:hover,
        .filter-btn.active {
            background: rgba(139, 92, 246, 0.4);
            border-color: rgba(139, 92, 246, 0.6);
        }
        
        .stats-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: rgba(139, 92, 246, 0.1);
            border-radius: 8px;
            margin-bottom: 2rem;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-item .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #8B5CF6;
        }
        
        .stat-item .stat-label {
            font-size: 0.85rem;
            color: #aaa;
            margin-top: 0.25rem;
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-container">
            <a href="../index.html" class="nav-logo">
                <img src="../assets/logo_character.png" alt="RToC" class="nav-logo-img"
                    style="width:36px; height:36px; border-radius:8px; object-fit:cover;">
                RToC Wiki
            </a>

            <button class="nav-toggle">
                <span></span>
                <span></span>
                <span></span>
            </button>

            <ul class="nav-links">
                <li><a href="../index.html" class="nav-link">Home</a></li>
                <li><a href="characters.html" class="nav-link">Characters</a></li>
                <li><a href="concepts.html" class="nav-link">Concepts</a></li>
                <li><a href="plot.html" class="nav-link">Plot</a></li>
                <li><a href="cultivation.html" class="nav-link">Cultivation</a></li>
                <li><a href="martial_arts.html" class="nav-link">Martial Arts</a></li>
                <li><a href="appearances.html" class="nav-link">Appearances</a></li>
            </ul>

            <div class="nav-search">
                <ion-icon name="search-outline" class="nav-search-icon"></ion-icon>
                <input type="text" placeholder="Search the wiki...">
            </div>

            <a href="pages.html" class="nav-link" style="margin-right: 1rem; color: #8B5CF6; font-weight: 600;">{Pages}</a>
            <button class="login-btn">Log In</button>
        </div>
    </nav>

    <!-- Pages Preview Section -->
    <div class="pages-container">
        <div class="pages-header">
            <h1>All Pages</h1>
            <p>Browse every page in the RToC Wiki</p>
        </div>

        <!-- Stats Bar -->
        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-number" id="totalPages">0</div>
                <div class="stat-label">Total Pages</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="charactersCount">0</div>
                <div class="stat-label">Characters</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="conceptsCount">0</div>
                <div class="stat-label">Concepts</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="cultivationCount">0</div>
                <div class="stat-label">Cultivation</div>
            </div>
        </div>

        <!-- Search and Filter -->
        <div class="search-filter">
            <input type="text" id="pageSearch" placeholder="Search pages by name...">
            <div class="filter-buttons">
                <button class="filter-btn active" data-filter="all">All</button>
                <button class="filter-btn" data-filter="characters">Characters</button>
                <button class="filter-btn" data-filter="concepts">Concepts</button>
                <button class="filter-btn" data-filter="cultivation">Cultivation</button>
                <button class="filter-btn" data-filter="martial_arts">Martial Arts</button>
                <button class="filter-btn" data-filter="cycles">Cycles</button>
                <button class="filter-btn" data-filter="realms">Realms</button>
            </div>
        </div>

        <!-- Pages Grid -->
        <div id="pagesGrid" class="pages-grid">
            <div class="loading-state">
                <ion-icon name="hourglass-outline"></ion-icon>
                <p>Loading pages...</p>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal-overlay">
        <div class="login-modal">
            <div class="modal-header">
                <button class="modal-close"><ion-icon name="close-outline"></ion-icon></button>
                <h2 class="modal-title">Community Access</h2>
                <p class="modal-subtitle">Join the sect via Discord</p>
            </div>

            <div class="social-login" style="flex-direction: column; gap: 1rem;">
                <button class="social-btn discord" id="discord-login-btn"
                    style="width: 100%; justify-content: center; padding: 1rem;">
                    <ion-icon name="logo-discord" style="font-size: 1.5rem;"></ion-icon>
                    Log In with Discord
                </button>
            </div>

            <p class="modal-subtitle" style="margin-top: 1rem; font-size: 0.8rem; opacity: 0.7;">
                (Authenticates via Discord OAuth2)
            </p>
        </div>
    </div>

    <script src="../scripts/api-config.js"></script>
    <script src="../scripts/main.js"></script>
    <script>
        let allPages = [];
        let filteredPages = [];

        // Get page name from path
        function getPageName(path) {
            const filename = path.split('/').pop().replace('.html', '');
            // Convert snake_case or kebab-case to Title Case
            return filename
                .split(/[_-]/)
                .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                .join(' ');
        }

        // Get category from path
        function getCategory(path) {
            if (path.includes('/characters/')) return 'characters';
            if (path.includes('/concepts/')) return 'concepts';
            if (path.includes('/cultivation/')) return 'cultivation';
            if (path.includes('/martial_arts/')) return 'martial_arts';
            if (path.includes('/cycles/')) return 'cycles';
            if (path.includes('/realms/')) return 'realms';
            if (path.includes('characters.html')) return 'characters';
            if (path.includes('concepts.html')) return 'concepts';
            if (path.includes('cultivation.html')) return 'cultivation';
            if (path.includes('martial_arts.html')) return 'martial_arts';
            if (path.includes('realms.html')) return 'realms';
            if (path.includes('plot.html')) return 'plot';
            if (path.includes('appearances.html')) return 'appearances';
            return 'other';
        }

        // Get icon for category
        function getCategoryIcon(category) {
            const icons = {
                'characters': 'person-outline',
                'concepts': 'planet-outline',
                'cultivation': 'flame-outline',
                'martial_arts': 'fitness-outline',
                'cycles': 'repeat-outline',
                'realms': 'map-outline',
                'plot': 'book-outline',
                'appearances': 'eye-outline',
                'other': 'document-text-outline'
            };
            return icons[category] || 'document-text-outline';
        }

        // Create page preview card
        function createPageCard(page) {
            const name = getPageName(page.path);
            const category = getCategory(page.path);
            const icon = getCategoryIcon(category);
            
            // Try to find a thumbnail image
            let thumbnailImg = '';
            if (category === 'characters') {
                // Try common character image paths
                const charName = page.path.split('/').pop().replace('.html', '');
                thumbnailImg = `<img src="../assets/images/${charName}_cover.jpg" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <img src="../assets/images/${charName}_profile.png" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div class="page-icon" style="display:none;"><ion-icon name="${icon}"></ion-icon></div>`;
            } else {
                thumbnailImg = `<div class="page-icon"><ion-icon name="${icon}"></ion-icon></div>`;
            }

            return `
                <a href="/${page.path}" class="page-preview-card" data-category="${category}" data-name="${name.toLowerCase()}">
                    <div class="page-preview-thumbnail">
                        ${thumbnailImg}
                    </div>
                    <div class="page-preview-content">
                        <div class="page-preview-name">${name}</div>
                        <div class="page-preview-path">/${page.path}</div>
                        <div class="page-preview-category">${category.replace('_', ' ')}</div>
                    </div>
                </a>
            `;
        }

        // Filter pages
        function filterPages() {
            const searchTerm = document.getElementById('pageSearch').value.toLowerCase();
            const activeFilter = document.querySelector('.filter-btn.active')?.dataset.filter || 'all';
            
            filteredPages = allPages.filter(page => {
                const name = getPageName(page.path).toLowerCase();
                const category = getCategory(page.path);
                const path = page.path.toLowerCase();
                
                const matchesSearch = !searchTerm || name.includes(searchTerm) || path.includes(searchTerm);
                const matchesFilter = activeFilter === 'all' || category === activeFilter;
                
                return matchesSearch && matchesFilter;
            });
            
            renderPages();
            updateStats();
        }

        // Render pages
        function renderPages() {
            const grid = document.getElementById('pagesGrid');
            
            if (filteredPages.length === 0) {
                grid.innerHTML = `
                    <div class="loading-state" style="grid-column: 1/-1;">
                        <ion-icon name="search-outline"></ion-icon>
                        <p>No pages found matching your search.</p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = filteredPages.map(page => createPageCard(page)).join('');
        }

        // Update stats
        function updateStats() {
            const categories = {
                characters: 0,
                concepts: 0,
                cultivation: 0
            };
            
            filteredPages.forEach(page => {
                const cat = getCategory(page.path);
                if (categories.hasOwnProperty(cat)) {
                    categories[cat]++;
                }
            });
            
            document.getElementById('totalPages').textContent = filteredPages.length;
            document.getElementById('charactersCount').textContent = categories.characters;
            document.getElementById('conceptsCount').textContent = categories.concepts;
            document.getElementById('cultivationCount').textContent = categories.cultivation;
        }

        // Load all pages
        async function loadPages() {
            try {
                const response = await window.rtocFetch('/api/pages');
                const data = await response.json();
                
                if (data.status === 'success') {
                    // Filter out admin pages, templates, and auth pages
                    allPages = data.pages.filter(page => {
                        const path = page.path.toLowerCase();
                        return !path.includes('admin/') && 
                               !path.includes('template') && 
                               !path.includes('auth/') &&
                               !path.includes('callback') &&
                               path !== 'index.html';
                    });
                    
                    // Sort by name
                    allPages.sort((a, b) => {
                        const nameA = getPageName(a.path);
                        const nameB = getPageName(b.path);
                        return nameA.localeCompare(nameB);
                    });
                    
                    filteredPages = [...allPages];
                    renderPages();
                    updateStats();
                }
            } catch (error) {
                console.error('Failed to load pages:', error);
                document.getElementById('pagesGrid').innerHTML = `
                    <div class="loading-state" style="grid-column: 1/-1;">
                        <ion-icon name="alert-circle-outline"></ion-icon>
                        <p>Failed to load pages. Please try again later.</p>
                    </div>
                `;
            }
        }

        // Event listeners
        document.getElementById('pageSearch').addEventListener('input', filterPages);
        
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                filterPages();
            });
        });

        // Load pages on page load
        loadPages();
    </script>
</body>

</html>

